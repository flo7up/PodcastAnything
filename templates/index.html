<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Podcast Anything</title>
    
    <style>
        /* Insert the updated CSS here */
    </style>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        // Function to handle autosave
        function autoSaveText(field, textType) {
            clearTimeout(window.autosaveTimer);
            window.autosaveTimer = setTimeout(function() {
                // Get the value from the field
                var text = $(field).val();
                
                // Send an AJAX request to the server
                $.ajax({
                    url: '/autosave',  // The new route in Flask
                    type: 'POST',
                    data: {
                        'text': text,
                        'text_type': textType  // Either 'extracted_text' or 'conversation'
                    },
                    success: function(response) {
                        console.log('Autosave successful');
                    },
                    error: function() {
                        console.log('Autosave failed');
                    }
                });
            }, 1000);  // Wait 1 second after the user stops typing before autosaving
        }

        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById('outlineForm');
            const generateButton = document.getElementById('generate_outline');
            const loadingSpinner = document.getElementById('loading');
        
            // Handle form submission to show spinner
            form.addEventListener('submit', function(event) {
                // Disable the button and show the spinner
                generateButton.disabled = true;
                loadingSpinner.style.display = 'inline-block';
        
                // Optionally, re-enable the button and hide spinner after form submission
                // This can be handled on the server response
            });
        
            // Attach the event handlers for autosave
            $('#text_content').on('input', function() {
                autoSaveText(this, 'extracted_text');
            });
        
            $('#conversation_text').on('input', function() {
                autoSaveText(this, 'conversation');
            });
        });
    </script>

    <!-- Link to External CSS (Optional) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Podcast Anything</h1>

        <!-- Centered logo -->
        <div class="logo-container">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Podcast Anything Logo">
        </div>
        <h2>Input Content</h2>
        <div class="options-container">
            <!-- Option 1: Upload PDF -->
            <div class="option">
                <h2>Upload PDF</h2>
                
                <!-- Form to Upload PDF -->
                <form action="/" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="action" value="upload_pdf">
                    
                    <label for="pdf_file">Select PDF to Upload:</label>
                    <input type="file" name="pdf_file" id="pdf_file" accept=".pdf" required>
                    
                    <div class="buttons">
                        <input type="submit" name="upload_pdf" id="upload_pdf" value="Upload PDF">
                    </div>
                </form>
                
                <!-- Form to Convert PDF to Text -->
                <form action="/" method="post">
                    <input type="hidden" name="action" value="convert_pdf">
                    
                    <label for="use_azure_doc_intelligence">
                        <input type="checkbox" name="use_azure_doc_intelligence" id="use_azure_doc_intelligence" checked>
                        Use Azure Document Intelligence
                    </label>
                    
                    <div class="buttons">
                        <input type="submit" name="convert_pdf" id="convert_pdf" value="Convert PDF to Text">
                    </div>
                </form>
            </div>
            <div class="optiondivider">
                <h2>Or</h2>
            </div>  
            <!-- Option 2: Extract Text from Website -->
            <div class="option">
                <h2>Extract Text from Website</h2>
                
                <!-- Form to Extract Text from Website -->
                <form action="/" method="post">
                    <input type="hidden" name="action" value="extract_website">
                    
                    <label for="website_url">Website URL:</label>
                    <input type="url" name="website_url" id="website_url" placeholder="Enter website URL here..." required>
                    
                    <div class="buttons">
                        <input type="submit" name="extract_website" id="extract_website_text" value="Extract Text from Website">
                    </div>
                </form>
            </div>
        </div>
        <br>
        <!-- Generate Podcast Outline Section -->
        
        <form action="/" method="post" id="outlineForm">
            <input type="hidden" name="action" value="generate_outline">
            
            <label for="text_content">Enter or Edit Extracted Text:</label>
            <textarea name="text_content" id="text_content" rows="10" required>{{ text_content }}</textarea>
            
            <div class="buttons">
                <input type="submit" id="generate_outline" value="Generate Outline">
                <!-- Loading spinner -->
                <div id="loading"></div>
            </div>
        </form>
        
        <!-- Step 4: Generate Audio Podcast -->
        <h2>Podcast Outline</h2>
        <form action="/" method="post" id="generateAudioForm">
            <input type="hidden" name="action" value="generate_audio">
            
            <div class="form-group voice-selection">
                <label>Select Voices for Speakers:</label>
                <div class="voice-selectors">
                    <div class="voice-selector">
                        <label for="speaker1_voice">Speaker 1:</label>
                        <select name="speaker1_voice" id="speaker1_voice" required>
                            {% for voice in available_voices %}
                                <option value="{{ voice.name }}" {% if voice.name == selected_voice1 %}selected{% endif %}>
                                    {{ voice.display_name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
            
                    <div class="voice-selector">
                        <label for="speaker2_voice">Speaker 2:</label>
                        <select name="speaker2_voice" id="speaker2_voice" required>
                            {% for voice in available_voices %}
                                <option value="{{ voice.name }}" {% if voice.name == selected_voice2 %}selected{% endif %}>
                                    {{ voice.display_name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <label for="conversation_text">Review/Edit Conversation Outline:</label>
            <textarea name="conversation_text" id="conversation_text" rows="20" placeholder="The generated conversation outline will appear here..." required>{{ conversation }}</textarea>
            
            <div class="buttons">
                <input type="submit" name="generate_audio" id="generate_audio" value="Generate Audio">
            </div>
        </form>

        <!-- Display Error Messages -->
        {% if error %}
            <p class="error">{{ error }}</p>
        {% endif %}

        <!-- Audio Output Section -->
        {% if audio_file %}
            <div class="audio-section">
                <h2>Your Podcast is Ready!</h2>
                <audio controls>
                    <source src="{{ url_for('static', filename=audio_file.split('/')[-1]) }}" type="audio/wav">
                    Your browser does not support the audio element.
                </audio>
                <a href="{{ url_for('static', filename=audio_file.split('/')[-1]) }}" download>Download Podcast</a>
            </div>
        {% endif %}
    </div>
</body>
</html>
